<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Movimientos Pendientes - Supervisor</title>
  </head>
  <body>
    <div th:replace="~{layout :: layout(~{::section})}">
      <section>
        <div class="min-h-screen bg-gray-100 py-8">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">
              Movimientos Pendientes para <span th:text="${rubroNombre}"></span>
            </h1>

            <!-- Mensajes de éxito/error -->ay
            <div th:if="${mensaje != null}" id="mensajeAlert" class="mb-6">
              <div
                th:class="${tipoMensaje == 'error' ? 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative' : 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative'}"
                role="alert"
              >
                <span class="block sm:inline" th:text="${mensaje}"></span>
              </div>
            </div>

            <!-- Entradas Pendientes -->
            <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
              <div class="px-4 py-5 sm:px-6">
                <h2 class="text-lg leading-6 font-medium text-gray-900">
                  Entradas Pendientes
                </h2>
                <p class="mt-1 max-w-2xl text-sm text-gray-500">
                  Revisa y aprueba las entradas de productos al inventario.
                </p>
              </div>
              <div class="border-t border-gray-200">
                <div
                  th:if="${entradasPendientes.empty}"
                  class="p-4 text-gray-500"
                >
                  No hay entradas pendientes para este rubro.
                </div>
                <div
                  th:unless="${entradasPendientes.empty}"
                  class="overflow-x-auto"
                >
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          ID
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Número Factura
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Proveedor
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Fecha
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Costo Total
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Acciones
                        </th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <tr th:each="entrada : ${entradasPendientes}">
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
                          th:text="${entrada.idEntrada}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${entrada.numeroFactura}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${entrada.proveedorNombre}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${#temporals.format(entrada.fechaEntrada, 'dd/MM/yyyy HH:mm')}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${'S/ ' + #numbers.formatDecimal(entrada.costoTotal, 1, 2)}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
                        >
                          <form
                            th:action="@{/supervisor/kardex/aprobar/entrada/{id}(id=${entrada.idEntrada})}"
                            method="post"
                            class="inline-block"
                          >
                            <input
                              type="hidden"
                              name="rubroCode"
                              th:value="${rubroCode}"
                            />
                            <button
                              type="submit"
                              class="text-green-600 hover:text-green-900 mr-4"
                            >
                              Aprobar
                            </button>
                          </form>
                          <form
                            th:action="@{/supervisor/kardex/anular/entrada/{id}(id=${entrada.idEntrada})}"
                            method="post"
                            class="inline-block"
                          >
                            <input
                              type="hidden"
                              name="rubroCode"
                              th:value="${rubroCode}"
                            />
                            <input
                              type="hidden"
                              name="motivo"
                              value="Anulado por supervisor"
                            />
                            <button
                              type="submit"
                              class="text-red-600 hover:text-red-900"
                            >
                              Anular
                            </button>
                          </form>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Salidas Pendientes -->
            <div class="bg-white shadow overflow-hidden sm:rounded-lg">
              <div class="px-4 py-5 sm:px-6">
                <h2 class="text-lg leading-6 font-medium text-gray-900">
                  Salidas Pendientes
                </h2>
                <p class="mt-1 max-w-2xl text-sm text-gray-500">
                  Revisa y aprueba las salidas de productos del inventario.
                </p>
              </div>
              <div class="border-t border-gray-200">
                <div
                  th:if="${salidasPendientes.empty}"
                  class="p-4 text-gray-500"
                >
                  No hay salidas pendientes para este rubro.
                </div>
                <div
                  th:unless="${salidasPendientes.empty}"
                  class="overflow-x-auto"
                >
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          ID
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Número Documento
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Cliente
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Fecha
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Total Venta
                        </th>
                        <th
                          scope="col"
                          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Acciones
                        </th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <tr th:each="salida : ${salidasPendientes}">
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
                          th:text="${salida.idSalida}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${salida.numeroDocumento}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${salida.clienteNombre}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${#temporals.format(salida.fechaSalida, 'dd/MM/yyyy HH:mm')}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                          th:text="${'S/ ' + #numbers.formatDecimal(salida.totalVenta, 1, 2)}"
                        ></td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
                        >
                          <form
                            th:action="@{/supervisor/kardex/aprobar/salida/{id}(id=${salida.idSalida})}"
                            method="post"
                            class="inline-block"
                          >
                            <input
                              type="hidden"
                              name="rubroCode"
                              th:value="${rubroCode}"
                            />
                            <button
                              type="submit"
                              class="text-green-600 hover:text-green-900 mr-4"
                            >
                              Aprobar
                            </button>
                          </form>
                          <form
                            th:action="@{/supervisor/kardex/anular/salida/{id}(id=${salida.idSalida})}"
                            method="post"
                            class="inline-block"
                          >
                            <input
                              type="hidden"
                              name="rubroCode"
                              th:value="${rubroCode}"
                            />
                            <input
                              type="hidden"
                              name="motivo"
                              value="Anulado por supervisor"
                            />
                            <button
                              type="submit"
                              class="text-red-600 hover:text-red-900"
                            >
                              Anular
                            </button>
                          </form>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script>
      // Script para ocultar mensajes de alertaa
      document.addEventListener("DOMContentLoaded", function () {
        const mensajeAlert = document.getElementById("mensajeAlert");
        if (mensajeAlert) {
          setTimeout(function () {
            mensajeAlert.style.transition = "opacity 0.5s ease-out";
            mensajeAlert.style.opacity = "0";
            setTimeout(function () {
              mensajeAlert.remove();
            }, 500);
          }, 5000);
        }
      });
    </script>
  </body>
</html>
