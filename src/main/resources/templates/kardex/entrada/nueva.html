<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nueva Entrada - Kardex</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center">
            <a
              href="/kardex/dashboard"
              class="text-blue-600 hover:text-blue-800 mr-4"
            >
              <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <i class="fas fa-plus text-2xl text-green-600 mr-3"></i>
            <h1 class="text-2xl font-bold text-gray-900">
              Nueva Entrada de Inventario
            </h1>
          </div>
          <div class="flex space-x-3">
            <button
              type="button"
              onclick="history.back()"
              class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"
            >
              Cancelar
            </button>
            <button
              type="submit"
              form="entradaForm"
              class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg"
            >
              Guardar Entrada
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <form
        id="entradaForm"
        th:action="@{/kardex/entrada/guardar}"
        method="post"
        class="space-y-8"
      >
        <!-- Información General -->
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">
            Información General
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label
                for="fechaEntrada"
                class="block text-sm font-medium text-gray-700 mb-2"
              >
                Fecha de Entrada *
              </label>
              <input
                type="date"
                id="fechaEntrada"
                name="fechaEntrada"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
              />
            </div>
            <div>
              <label
                for="proveedor"
                class="block text-sm font-medium text-gray-700 mb-2"
              >
                Proveedor *
              </label>
              <select
                id="proveedor"
                name="proveedorId"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
              >
                <option value="">Seleccionar proveedor</option>
                <option value="1">Proveedor A - Piñatería</option>
                <option value="2">Proveedor B - Librería</option>
                <option value="3">Proveedor C - Electrónicos</option>
              </select>
            </div>
            <div>
              <label
                for="numeroFactura"
                class="block text-sm font-medium text-gray-700 mb-2"
              >
                Número de Factura/Boleta
              </label>
              <input
                type="text"
                id="numeroFactura"
                name="numeroFactura"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                placeholder="F001-00012345"
              />
            </div>
            <div>
              <label
                for="tipoDocumento"
                class="block text-sm font-medium text-gray-700 mb-2"
              >
                Tipo de Documento
              </label>
              <select
                id="tipoDocumento"
                name="tipoDocumento"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
              >
                <option value="FACTURA">Factura</option>
                <option value="BOLETA">Boleta</option>
                <option value="GUIA">Guía de Remisión</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Productos -->
        <div class="bg-white rounded-lg shadow p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-gray-900">Productos</h2>
            <button
              type="button"
              onclick="agregarProducto()"
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center"
            >
              <i class="fas fa-plus mr-2"></i>
              Agregar Producto
            </button>
          </div>

          <div id="productosContainer" class="space-y-4">
            <!-- Producto 1 -->
            <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Producto *</label
                  >
                  <select
                    name="productos[0].productoId"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                  >
                    <option value="">Seleccionar producto</option>
                    <option value="1">Piñata Grande - S/ 25.00</option>
                    <option value="2">Piñata Mediana - S/ 18.00</option>
                    <option value="3">Libro Matemáticas - S/ 35.00</option>
                    <option value="4">Cámara HD - S/ 150.00</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Cantidad *</label
                  >
                  <input
                    type="number"
                    name="productos[0].cantidad"
                    min="1"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                    placeholder="0"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Precio Unitario *</label
                  >
                  <input
                    type="number"
                    name="productos[0].precioUnitario"
                    min="0"
                    step="0.01"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                    placeholder="0.00"
                  />
                </div>
                <div class="flex items-end">
                  <button
                    type="button"
                    onclick="eliminarProducto(this)"
                    class="w-full bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Observaciones -->
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">
            Observaciones
          </h2>
          <textarea
            name="observaciones"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
            placeholder="Observaciones adicionales sobre la entrada..."
          ></textarea>
        </div>

        <!-- Resumen -->
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">Resumen</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center p-4 bg-blue-50 rounded-lg">
              <p class="text-sm text-gray-600">Total Productos</p>
              <p class="text-2xl font-bold text-blue-600" id="totalProductos">
                0
              </p>
            </div>
            <div class="text-center p-4 bg-green-50 rounded-lg">
              <p class="text-sm text-gray-600">Subtotal</p>
              <p class="text-2xl font-bold text-green-600" id="subtotal">
                S/ 0.00
              </p>
            </div>
            <div class="text-center p-4 bg-purple-50 rounded-lg">
              <p class="text-sm text-gray-600">IGV (18%)</p>
              <p class="text-2xl font-bold text-purple-600" id="igv">S/ 0.00</p>
            </div>
          </div>
          <div class="mt-6 text-center">
            <p class="text-sm text-gray-600">Total General</p>
            <p class="text-3xl font-bold text-gray-900" id="totalGeneral">
              S/ 0.00
            </p>
          </div>
        </div>
      </form>
    </main>

    <script>
      let productoIndex = 1;

      function agregarProducto() {
        const container = document.getElementById("productosContainer");
        const nuevoProducto = document.createElement("div");
        nuevoProducto.className =
          "border border-gray-200 rounded-lg p-4 bg-gray-50";
        nuevoProducto.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Producto *</label>
                        <select name="productos[${productoIndex}].productoId" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="">Seleccionar producto</option>
                            <option value="1">Piñata Grande - S/ 25.00</option>
                            <option value="2">Piñata Mediana - S/ 18.00</option>
                            <option value="3">Libro Matemáticas - S/ 35.00</option>
                            <option value="4">Cámara HD - S/ 150.00</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cantidad *</label>
                        <input type="number" name="productos[${productoIndex}].cantidad" min="1" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                               placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Precio Unitario *</label>
                        <input type="number" name="productos[${productoIndex}].precioUnitario" min="0" step="0.01" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                               placeholder="0.00">
                    </div>
                    <div class="flex items-end">
                        <button type="button" onclick="eliminarProducto(this)" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        container.appendChild(nuevoProducto);
        productoIndex++;
      }

      function eliminarProducto(button) {
        const productoDiv = button.closest(".border");
        productoDiv.remove();
      }

      // Calcular totales cuando cambien los valores
      document.addEventListener("input", function (e) {
        if (
          e.target.name.includes("cantidad") ||
          e.target.name.includes("precioUnitario")
        ) {
          calcularTotales();
        }
      });

      function calcularTotales() {
        let totalProductos = 0;
        let subtotal = 0;

        // Obtener todos los productos
        const productos = document.querySelectorAll('[name*="productoId"]');
        productos.forEach((producto, index) => {
          const cantidad = document.querySelector(
            `[name="productos[${index}].cantidad"]`
          );
          const precio = document.querySelector(
            `[name="productos[${index}].precioUnitario"]`
          );

          if (cantidad && precio && cantidad.value && precio.value) {
            const cant = parseInt(cantidad.value);
            const prec = parseFloat(precio.value);
            totalProductos += cant;
            subtotal += cant * prec;
          }
        });

        const igv = subtotal * 0.18;
        const total = subtotal + igv;

        document.getElementById("totalProductos").textContent = totalProductos;
        document.getElementById(
          "subtotal"
        ).textContent = `S/ ${subtotal.toFixed(2)}`;
        document.getElementById("igv").textContent = `S/ ${igv.toFixed(2)}`;
        document.getElementById(
          "totalGeneral"
        ).textContent = `S/ ${total.toFixed(2)}`;
      }
    </script>
  </body>
</html>
